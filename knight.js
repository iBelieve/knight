function n(n){this.name=n}function t(n){this.name=n}function e(n){return!1===n||null==n}function r(n){return null==n}function o(n){return null!=n}function i(t){return t instanceof n}function u(n){return n instanceof t}function c(n){return"number"==typeof n||n instanceof Number}function l(n){return-1*n}function a(n){return"string"==typeof n||n instanceof String}function f(n){return Array.isArray(n)}function s(n){return 0===n.length}function p(n){return o(n)&&n.length>0}function d(...n){return[...n]}function m(n,t){return n.map(t)}function y(n,t,e){return n.map((o,i)=>i===n.length-1?e(o):r(t)?o:t(o))}function g(n,...t){return[...n,...t]}function b(n,t){return n+t}function x(n,t){return n.startsWith(t)}function h(n,t){return n.endsWith(t)}function S(){return new Map}function v(n,t){return n.get(t)}function E(n,t,e){return n.set(t,e)}function w(n){return new Map(n)}function j(n,t){return n.has(t)}let I=S(),A=S();function k(t){return e(j(I,t))&&E(I,t,new n(t)),v(I,t)}function F(n){return n.name}function C(n){return n.name}function V(n){return n[0]}function q(n){return n[1]}function B(n){return n.slice(1)}function M(n){return n.slice(2)}function U(n,t){return new RegExp(n,t)}function W(n){throw new Error(n)}function O(n,t){return f(n)&&V(n)===t}function R(n){return r(n)?"nil":JSON.stringify(n)}function*L(n,t){{let e=0;for(;;){if(!(e<n.length))return;yield n.slice(e,e+t),e+=t}}}function D(...n){return m(V(n),(t,e)=>m(n,n=>n[e]))}function N(n){return o(n)?n.valueOf():null}let $=Symbol("meta");function z(n){return n[$]}function P(n,t){return n.repeat(t)}function J(n,t,e){return n.padStart(t,e)}function T(n){return r(n)?"nil":n.toString()}function G(n){return{input:n,index:0,indentWarnings:[]}}let Y=S();function Z(n,t){{let e=U("\r\n?|\n","g"),r=o(t)?n.index+t:n.index;{let t=1,o=0;for(;;){e.lastindex=o;{let i=e.exec(n.input);if(i&&i.index<r){t+=1,o=i.index+i[0].length;continue}return{line:t,column:r-o}}}}}}function _(n,t,e,r){return n.indentWarnings.push({startIndex:t,endChar:e,pos:r})}function H(n,t,e,r){{let u=(o=n.indentWarnings,i=n=>n.startIndex>=t,o.find(i));return console.error(u),W("Unexpected EOF, expected: '"+r+"'\n\nStarted here:\n"+pn(n.input,e)+"\n\nBased on indent:\n"+pn(n.input,u.pos))}var o,i}function K(n){{let t=n.input[n.index];return n.index=n.index+1,t}}function Q(n,t){return n.input[o(t)?n.index+t:n.index]}function X(n){return n.index<n.input.length}function nn(n){return" "===n||"\t"===n||"\n"===n||","===n}function tn(n){return n>="0"&&n<="9"}function en(n){return j(Y,n)}function rn(n,t){{let e=n.index,r=n.input.length;{let o=n.index;for(;;){if(o>=r||t(n.input[o]))return n.index=o,n.input.substring(e,o);o+=1}}}}function on(n,t){return rn(n,n=>e(t(n)))}function un(n){for(;;){if(on(n,n=>nn(n)),";"!==Q(n))return;rn(n,n=>"\n"===n)}}function cn(n){return b(K(n),rn(n,n=>nn(n)||en(n)))}function ln(n){return"nil"===n?null:"true"===n||"false"!==n&&(x(n,":")||h(n,":")?function(n){{let r=x(n,":")?n.substring(1):h(n,":")?n.substring(0,n.length-1):n;return e(j(A,r))&&E(A,r,new t(r)),v(A,r)}}(n):k(n))}function an(n){{let t=cn(n);return function(n,t){return n.includes(t)}(t,".")?parseFloat(t):parseInt(t)}}function fn(n,t){return W(b("Unmatched delimiter: ",t))}function sn(n){{let t=K(n),e=K(n),r=K(n),o=K(n);return String.fromCharCode(parseInt(t+e+r+o))}}function pn(n,t){{let e=t.line-1,r=e-1,o=e+1,i=n.split("\n"),u=i[e],c=i[r]||"",l=i[o]||"",a=b(P(" ",t.column),"^"),f=T(e+1),s=T(r+1),p=T(o+1),d=function(...n){return Math.max(...n)}(f.length,s.length,p.length);return J(s,d)+" "+c+"\n"+J(f,d)+" "+u+"\n"+P(" ",d)+" "+a+"\n"+J(p,d)+" "+l}}function dn(n,t){{let o=!1,i=n.index-1,u=Z(n,-1),c=u.line,l=u.column;{let a=d();for(;;){if(e(o)){let e=Z(n);un(n);{let r=Z(n),u=r.line,a=r.column;u>c&&a<=l&&(o=!0,_(n,i,t,e))}}{let e=Q(n);if(r(e))return H(n,i,u,t);if(e===t)return K(n),a;a=g(a,yn(n));continue}}}}}function mn(n){un(n);{let t=Q(n);if(tn(t))return an(n);if(en(t)){let e=v(Y,t);return K(n),e(n,t)}return"+"!==t&&"-"!==t||!tn(Q(n,1))?ln(cn(n)):an(n)}}function yn(n){{let t=Z(n),e=mn(n),r=Z(n);return o(e)&&function(n,t){n[$]=t}(e,{loc:{source:n.input,start:t,end:r}}),e}}E(Y,"'",(function(n){return d(k("quote"),mn(n))})),E(Y,"\\",(function(n){{let t=cn(n);return"newline"===t?"\n":"return"===t?"\r":"tab"===t?"\t":"space"===t?" ":1===t.length?t:W("Unrecognized char: '"+t+"'")}})),E(Y,'"',(function(n,t){{let t="";for(;;){let e=b(t,rn(n,n=>'"'===n||"\\"===n)),o=K(n);if(r(o))return W("Unexpected EOF while reading string");if('"'===o)return e;if("\\"===o){let o=K(n),i=r(o)?W("Unexpected EOF while reading character escape"):'"'===o||"\\"===o||"/"===o?o:"n"===o?"\n":"t"===o?"\t":"r"===o?"\r":"u"===o?sn(n):b(W("Unrecognized character escape"));t=b(e,i);continue}}}})),E(Y,"(",(function(n,t){return dn(n,")")})),E(Y,")",fn),E(Y,"[",(function(n,t){return dn(n,"]")})),E(Y,"]",fn),E(Y,"{",(function(n,t){return d(k("dict"),...dn(n,"}"))})),E(Y,"}",fn);let gn=function(...n){return new Set(n)}("var","let","const"),bn=S();function xn(n){return i(n)&&x(F(n),".-")}function hn(n){{let t=n.type;return"Literal"===t||"Identifier"===t||h(t,"Expression")||h(t,"Element")}}function Sn(n,t){if(z(n)&&z(n).loc){let e=z(n).loc;return W(t+"\n\n"+pn(e.source,e.start))}return W(t)}function vn(n){return{variables:w(n.variables),loopVariables:o(n.loopVariables)?(t=n.loopVariables,Array.from(t)):void 0,isLoop:!1};var t}function En(n){return function(n){return n.replace("!","").replace("->","-to-").replace(U("^((contains|has).*)\\?$"),"$1").replace(U("^(.*)\\?$"),"is-$1")}(n).replace(U("[-_]([a-zA-Z])","g"),(n,t)=>t.toUpperCase())}function wn(n){return function(n){return function(n,t){return n.has(t)}(gn,n)}(n)?b(n,"$"):n}function jn(n){return n===k("Symbol")?"LispSymbol":wn(En(F(n)))}function In(n,t){{let r=n.variables;return e(j(r,t))&&E(r,t,jn(t)),n.isLoop&&n.loopVariables.push(t),kn(n,t)}}function An(n,t){{let r=n.variables;return e(j(r,t))&&E(r,t,jn(t)),kn(n,t)}}function kn(n,t){{let r=n.variables,o=F(t),i=z(t)?z(t).loc:void 0;return x(o,"js/")?{type:"Identifier",name:o.substring(3),originalName:o,loc:i}:e(j(r,t))?Sn(t,"Symbol not found: "+o):{type:"Identifier",name:v(r,t),originalName:F(t),loc:i}}}function Fn(n){return function(n){return{type:"CallExpression",callee:{type:"ArrowFunctionExpression",id:null,params:[],body:{type:"BlockStatement",body:[Cn(n)],loc:n.loc}},arguments:[]}}(n)}function Cn(n){{let e=n.type;return"ReturnStatement"===e||"ForOfStatement"===e||"ContinueStatement"===e||"ThrowStatement"===e?n:"ExpressionStatement"===e?{type:"ReturnStatement",argument:n.expression,loc:n.loc}:"BlockStatement"===e?{type:"BlockStatement",body:(t=n.body,s(t)?[{type:"ReturnStatement",argument:null}]:y(t,null,Cn)),loc:n.loc}:"WhileStatement"===e?{type:"WhileStatement",test:n.test,body:Cn(n.body),loc:n.loc}:"IfStatement"===e?{type:"IfStatement",test:n.test,consequent:Cn(n.consequent),alternate:n.alternate?Cn(n.alternate):null,loc:n.loc}:W(b("Unsupported return statement: ",e))}var t}function Vn(n,t){return y(t,t=>Mn(n,t),t=>function(n,t){{let e=Dn(n,t);return hn(e)?{type:"ReturnStatement",argument:e,loc:e.loc}:Cn(e)}}(n,t))}function qn(n,t){return{type:"BlockStatement",body:Vn(n,t)}}function Bn(n,t){return m(t,t=>Mn(n,t))}function Mn(n,t){{let e=Dn(n,t);return hn(e)?{type:"ExpressionStatement",expression:e,loc:e.loc}:e}}function Un(n,t){return m(t,t=>Wn(n,t))}function Wn(n,t){{let e=Dn(n,t);return hn(e)?e:Fn(e)}}function On(n,t){return m(t,t=>Rn(n,t))}function Rn(n,t){return i(t)?In(n,t):O(t,k("spread"))?{type:"RestElement",argument:In(n,q(t)),loc:z(t).loc}:f(t)?{type:"ArrayPattern",elements:On(n,t)}:Sn(t,"Unrecognized pattern")}function Ln(n,t){return function(n){return f(n)&&1===n.length}(t)?Mn(n,V(t)):{type:"BlockStatement",body:Bn(n,t)}}function Dn(n,t){return i(t)?function(n,t){return kn(n,t)}(n,t):f(t)?function(n,t){{let e=z(t)?z(t).loc:void 0,r=V(t),o=B(t);return xn(r)?function(n,t,e,r){{let o=F(e).substring(2),i=V(r);return{type:"MemberExpression",object:Wn(n,i),property:{type:"Identifier",name:o,loc:z(e).loc},computed:!1,loc:t}}}(n,e,r,o):function(n){return i(n)&&x(F(n),".")}(r)?function(n,t,e,r){{let o=F(e).substring(1),i=V(r),u=B(r);return{type:"CallExpression",callee:{type:"MemberExpression",object:Wn(n,i),property:{type:"Identifier",name:o,loc:z(e).loc},computed:!1},arguments:Un(n,u),loc:t}}}(n,e,r,o):function(n){return i(n)&&j(bn,n)}(r)?v(bn,r)(n,e,o):function(n,t,e,r){return{type:"CallExpression",callee:Wn(n,e),arguments:Un(n,r),loc:t}}(n,e,r,o)}}(n,t):Nn(n,t)}function Nn(n,t){return void 0===t?W("Undefined!"):u(t)?Dn(n,d(k("string->keyword"),C(t))):c(e=t)&&e<0?{type:"UnaryExpression",operator:"-",prefix:!0,argument:{type:"Literal",value:l(N(t))},loc:o(t)&&z(t)?z(t).loc:void 0}:{type:"Literal",value:N(t),loc:o(t)&&z(t)?z(t).loc:void 0};var e}function $n(n,t,e){return{type:"ReturnStatement",argument:p(e)?Wn(n,V(e)):void 0,loc:t}}function zn(n){return(t,e,r)=>(s(r)&&W("Empty operator expression"),Un(t,r).reduce((t,r)=>({type:"BinaryExpression",operator:n,left:t,right:r,loc:e})))}function Pn(n,t){return{type:"VariableDeclaration",kind:"let",declarations:m(Array.from(L(t,2)),t=>({type:"VariableDeclarator",id:In(n,V(t)),init:Wn(n,q(t))})),loc:z(t).loc}}function Jn(n){return i(n)?d(k("string->symbol"),F(n)):f(n)?g(d(k("js/array")),m(Jn,n)):n}function $n(n,t,e){return{type:"ReturnStatement",argument:p(e)?Wn(n,V(e)):null,loc:t}}E(bn,k("defn"),(function(n,t,e){{let r=An(n,V(e)),o=q(e),i=M(e),u=(a(V(i))&&p(B(i))?V(i):void 0)?B(i):i,c=vn(n);return{type:"FunctionDeclaration",id:r,params:On(c,o),body:qn(c,u),loc:t}}})),E(bn,k("defgen"),(function(n,t,e){{let r=An(n,V(e)),o=q(e),i=M(e),u=(a(V(i))&&p(B(i))?V(i):void 0)?B(i):i,c=vn(n);return{type:"FunctionDeclaration",id:r,params:On(c,o),body:qn(c,u),generator:!0,loc:t}}})),E(bn,k("return"),$n),E(bn,k("set!"),(function(n,t,e){{let r=V(e),o=q(e);return i(r)?function(n,t,e,r){return{type:"AssignmentExpression",operator:"=",left:kn(n,e),right:Wn(n,r),loc:t}}(n,t,r,o):f(r)?function(n,t,e,r){{let o=V(e),i=B(e);return xn(o)?function(n,t,e,r,o){{let i=F(e).substring(2),u=V(r);return{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",object:Wn(n,u),property:{type:"Identifier",name:i,loc:z(e).loc},computed:!1},right:Wn(n,o),loc:t}}}(n,t,o,i,r):o===k("js/index")?function(n,t,e,r){{let o=V(e),i=q(e);return{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",object:Wn(n,o),property:Wn(n,i),computed:!0},right:Wn(n,r),loc:t}}}(n,t,i,r):W(b("Invalid setter: ",R(e)))}}(n,t,r,o):W(b("Invalid setter: ",R(r)))}})),E(bn,k("and"),zn("&&")),E(bn,k("or"),zn("||")),E(bn,k("js/and"),zn("&&")),E(bn,k("js/or"),zn("||")),E(bn,k("js/==="),zn("===")),E(bn,k("js/!=="),zn("!==")),E(bn,k("js/=="),zn("==")),E(bn,k("js/!="),zn("!=")),E(bn,k("="),zn("===")),E(bn,k("!="),zn("!==")),E(bn,k(">="),zn(">=")),E(bn,k("<="),zn("<=")),E(bn,k(">"),zn(">")),E(bn,k("<"),zn("<")),E(bn,k("+"),zn("+")),E(bn,k("-"),zn("-")),E(bn,k("*"),zn("*")),E(bn,k("/"),zn("/")),E(bn,k("mod"),zn("%")),E(bn,k("js/instanceof"),zn("instanceof")),E(bn,k("spread"),(function(n,t,e){return{type:"SpreadElement",argument:Wn(n,V(e)),loc:t}})),E(bn,k("js/array"),(function(n,t,e){return{type:"ArrayExpression",elements:Un(n,e),loc:t}})),E(bn,k("fn"),(function(n,t,e){{let r=V(e),o=B(e),i=vn(n);return{type:"ArrowFunctionExpression",id:null,params:On(i,r),body:qn(i,o),loc:t}}})),E(bn,k("if"),(function(n,t,e){{let r=V(e),i=q(e),u=M(e);return{type:"IfStatement",test:Wn(n,r),consequent:Mn(n,i),alternate:o(u)?Ln(n,u):void 0,loc:t}}})),E(bn,k("for"),(function(n,t,e){{let r=V(V(e)),o=q(V(e)),i=B(e),u=vn(n);return{type:"ForOfStatement",left:Rn(u,r),right:Wn(u,o),body:Ln(u,i),loc:t}}})),E(bn,k("def"),(function(n,t,e){return{type:"VariableDeclaration",kind:"let",declarations:[{type:"VariableDeclarator",id:In(n,V(e)),init:Wn(n,q(e)),loc:t}],loc:t}})),E(bn,k("let"),(function(n,t,e){{let r=V(e),o=B(e),i=vn(n);return{type:"BlockStatement",body:[Pn(i,r),...Bn(i,o)],loc:t}}})),E(bn,k("cond"),(function(n,t,e){return function t(e){{let r=V(e),o=B(e),i=V(r),u=B(r);return i===k("else")?Ln(n,u):{type:"IfStatement",test:Wn(n,i),consequent:Ln(n,u),alternate:p(o)?t(o):void 0}}}(e)})),E(bn,k("loop"),(function(n,t,e){{let t=V(e),r=B(e),o=function(n){return{variables:w(n.variables),loopVariables:[],isLoop:!0}}(n);return s(t)?{type:"WhileStatement",test:Nn(o,!0),body:qn(o,r)}:{type:"BlockStatement",body:[Pn(o,t),{type:"WhileStatement",test:Nn(o,!0),body:qn(o,r)}]}}})),E(bn,k("do"),(function(n,t,e){return{type:"BlockStatement",body:Bn(n,e),loc:t}})),E(bn,k("yield"),(function(n,t,e){return{type:"YieldExpression",argument:Wn(n,V(e)),loc:t}})),E(bn,k("recur"),(function(n,t,e){return n.loopVariables.length!==e.length&&W("Recur with not enough args"+n.loopVariables.length+e.length),s(e)?{type:"ContinueStatement",loc:t}:{type:"BlockStatement",body:[...m(D(n.loopVariables,e),t=>({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:Rn(n,V(t)),right:Wn(n,q(t))}})),{type:"ContinueStatement"}],loc:t}})),E(bn,k("dict"),(function(n,t,e){return{type:"ObjectExpression",properties:m(Array.from(L(e,2)),t=>({type:"Property",key:u(V(t))?Nn(n,En(C(V(t)))):Nn(n,V(t)),value:Wn(n,q(t))}))}})),E(bn,k("quote"),(function(n,t,e){return Dn(n,Jn(V(e)))})),E(bn,k("js/return"),$n),E(bn,k("js/throw"),(function(n,t,e){return{type:"ThrowStatement",argument:Wn(n,V(e)),loc:t}})),E(bn,k("js/new"),(function(n,t,e){return{type:"NewExpression",callee:Wn(n,V(e)),arguments:Un(n,B(e)),loc:t}})),E(bn,k("js/index"),(function(n,t,e){{let t=V(e),r=q(e);return{type:"MemberExpression",object:Wn(n,t),property:Wn(n,r),computed:!0}}})),require("source-map-support/register");let Tn=require("fs"),Gn=require("escodegen"),Yn=require("terser"),Zn=require("commander").program;Zn.option("-o, --output <filename>","Output JS filename"),Zn.option("-m, --map","Generate source maps"),Zn.parse(process.argv);{let n=Zn.output,t=Zn.map?n?n+".map":"inline":void 0,e=Tn.readFileSync(0,"utf-8"),r=function(n){{let t={variables:S(),isLoop:!1};for(form of n)O(form,k("defn"))&&In(t,q(form));return{type:"Program",body:Bn(t,n)}}}(function(n){{let t=d();for(;;){if(un(n),!X(n))return t;t=g(t,yn(n))}}}(G(e))),o=Gn.generate(r,{sourceMap:"stdin",sourceMapWithCode:!0,sourceContent:e}),i=o.map.toString(),u=Yn.minify(o.code,{toplevel:!0,sourceMap:t?{content:i,url:t}:void 0});u.error?console.error(u.error):n?(Tn.writeFileSync(n,u.code),t&&"inline"!==t&&Tn.writeFileSync(t,u.map.toString())):function(...n){console.log(...n)}(u.code)}
//# sourceMappingURL=knight.js.map