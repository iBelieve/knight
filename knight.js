function n(){return new Map}function e(n,e,t){return n.set(e,t)}function t(...n){return[...n]}function r(n){return o(i(Un,n))&&e(Un,n,new u(n)),c(Un,n)}function o(n){return!1===n||null==n}function i(n,e){return n.has(e)}function u(n){this.name=n}function c(n,e){return n.get(e)}function l(n){a(n);{let u=d(n);if(y(u))return g(n);if(S(u)){let e=c(Ln,u);return h(n),e(n,u)}return"+"!==u&&"-"!==u||!y(d(n,1))?"nil"===(t=b(n))?null:"true"===t||"false"!==t&&(v(t,":")||E(t,":")?function(n){{let t=v(n,":")?n.substring(1):E(n,":")?n.substring(0,n.length-1):n;return o(i(Wn,t))&&e(Wn,t,new w(t)),c(Wn,t)}}(t):r(t)):g(n)}var t}function a(n){for(;;){if(s(n,n=>p(n)),";"!==d(n))return;f(n,n=>"\n"===n)}}function s(n,e){return f(n,n=>o(e(n)))}function f(n,e){{let t=n.index,r=n.input.length;{let o=n.index;for(;;){if(o>=r||e(n.input[o]))return n.index=o,n.input.substring(t,o);o+=1}}}}function p(n){return" "===n||"\t"===n||"\n"===n||","===n}function d(n,e){return n.input[m(e)?n.index+e:n.index]}function m(n){return null!=n}function y(n){return n>="0"&&n<="9"}function g(n){{let e=b(n);return function(n,e){return n.includes(e)}(e,".")?parseFloat(e):parseInt(e)}}function b(n){return x(h(n),f(n,n=>p(n)||S(n)))}function x(n,e){return n+e}function h(n){{let e=n.input[n.index];return n.index=n.index+1,e}}function S(n){return i(Ln,n)}function v(n,e){return n.startsWith(e)}function E(n,e){return n.endsWith(e)}function w(n){this.name=n}function j(n){throw new Error(n)}function I(n){return null==n}function N(n){{let e=h(n),t=h(n),r=h(n),o=h(n);return String.fromCharCode(parseInt(e+t+r+o))}}function k(n,e){{let r=!1,i=n.index-1,u=A(n,-1),c=u.line,l=u.column;{let s=t();for(;;){if(o(r)){let t=A(n);a(n);{let o=A(n),u=o.line,a=o.column;u>c&&a<=l&&(r=!0,q(n,i,e,t))}}{let t=d(n);if(I(t))return C(n,i,u,e);if(t===e)return h(n),s;s=W(s,O(n));continue}}}}}function A(n,e){{let t=F("\r\n?|\n","g"),r=m(e)?n.index+e:n.index;{let e=1,o=0;for(;;){t.lastindex=o;{let i=t.exec(n.input);if(i&&i.index<r){e+=1,o=i.index+i[0].length;continue}return{line:e,column:r-o}}}}}}function F(n,e){return new RegExp(n,e)}function q(n,e,t,r){return n.indentWarnings.push({startIndex:e,endChar:t,pos:r})}function C(n,e,t,r){{let u=(o=n.indentWarnings,i=n=>n.startIndex>=e,o.find(i));return console.error(u),j("Unexpected EOF, expected: '"+r+"'\n\nStarted here:\n"+V(n.input,t)+"\n\nBased on indent:\n"+V(n.input,u.pos))}var o,i}function V(n,e){{let t=e.line-1,r=t-1,o=t+1,i=n.split("\n"),u=i[t],c=i[r]||"",l=i[o]||"",a=x(B(" ",e.column),"^"),s=M(t+1),f=M(r+1),p=M(o+1),d=function(...n){return Math.max(...n)}(s.length,f.length,p.length);return U(f,d)+" "+c+"\n"+U(s,d)+" "+u+"\n"+B(" ",d)+" "+a+"\n"+U(p,d)+" "+l}}function B(n,e){return n.repeat(e)}function M(n){return I(n)?"nil":n.toString()}function U(n,e,t){return n.padStart(e,t)}function W(n,...e){return[...n,...e]}function O(n){{let e=A(n),t=l(n),r=A(n);return m(t)&&function(n,e){n[On]=e}(t,{loc:{source:n.input,start:e,end:r}}),t}}function L(n,e){return j(x("Unmatched delimiter: ",e))}function R(n){return n[0]}function D(n){return n===r("Symbol")?"LispSymbol":function(n){return function(n,e){return n.has(e)}(Rn,n)}(e=$(z(n)))?x(e,"$"):e;var e}function $(n){return function(n){return n.replace("!","").replace("->","-to-").replace(F("^((contains|has).*)\\?$"),"$1").replace(F("^(.*)\\?$"),"is-$1")}(n).replace(F("[-_]([a-zA-Z])","g"),(n,e)=>e.toUpperCase())}function z(n){return n.name}function P(n){return n[1]}function J(n){return n.slice(2)}function T(n){return"string"==typeof n||n instanceof String}function G(n){return m(n)&&n.length>0}function Y(n){return n.slice(1)}function Z(n){return{variables:_(n.variables),loopVariables:n.loopVariables,functions:n.functions,functionNodes:n.functionNodes,isLoop:!1}}function _(n){return new Map(n)}function H(n,t,r){{let o=n.functions;return i(o,t)?j("Function already defined: "+z(t)):e(o,t,r),null}}function K(n){return n instanceof u}function Q(n,t){{let u=n.variables,l=n.functions,a=n.functionNodes,s=z(t),f=X(t)?X(t).loc:void 0;return v(s,"js/")?{type:"Identifier",name:s.substring(3),originalName:s,loc:f}:i(u,t)?{type:"Identifier",name:c(u,t),originalName:s,loc:f}:i(l,t)?(o(i(a,t))&&function(n,t){{let o=Z(n);e(n.functionNodes,t.name,r("placeholder")),e(n.functionNodes,t.name,{type:"FunctionDeclaration",id:{type:"Identifier",name:t.ident,originalName:z(t.name),loc:X(t.name).loc},params:nn(o,t.params),body:cn(o,t.body),generator:t.generator,loc:t.loc})}}(n,c(l,t)),{type:"Identifier",name:c(l,t).ident,originalName:s,loc:f}):un(t,"Variable or function not found: "+s+" - "+en(Array.from(u.keys()),z)+" - "+en(Array.from(l.keys()),z))}}function X(n){return n[On]}function nn(n,e){return en(e,e=>tn(n,e))}function en(n,e){return n.map(e)}function tn(n,e){return K(e)?rn(n,e):(t=e,o=r("spread"),on(t)&&R(t)===o?{type:"RestElement",argument:rn(n,P(e)),loc:X(e).loc}:on(e)?{type:"ArrayPattern",elements:nn(n,e)}:un(e,"Unrecognized pattern"));var t,o}function rn(n,t){{let r=n.variables;return o(i(r,t))&&e(r,t,D(t)),n.isLoop&&n.loopVariables.push(t),Q(n,t)}}function on(n){return Array.isArray(n)}function un(n,e){if(X(n)&&X(n).loc){let t=X(n).loc;return j(e+"\n\n"+V(t.source,t.start))}return j(e)}function cn(n,e){return{type:"BlockStatement",body:ln(n,e)}}function ln(n,e){return an(sn(e,e=>fn(n,e),e=>function(n,e){{let t=pn(n,e);return yn(t)?{type:"ReturnStatement",argument:t,loc:t.loc}:gn(t)}}(n,e)))}function an(n){return function(n,e){return n.filter(e)}(n,n=>m(n))}function sn(n,e,t){return n.map((r,o)=>o===n.length-1?t(r):I(e)?r:e(r))}function fn(n,e){{let t=pn(n,e);return I(t)?t:yn(t)?{type:"ExpressionStatement",expression:t,loc:t.loc}:t}}function pn(n,e){return K(e)?function(n,e){return Q(n,e)}(n,e):on(e)?function(n,e){{let t=X(e)?X(e).loc:void 0,r=R(e),o=Y(e);return dn(r)?function(n,e,t,r){{let o=z(t).substring(2),i=R(r);return{type:"MemberExpression",object:mn(n,i),property:{type:"Identifier",name:o,loc:X(t).loc},computed:!1,loc:e}}}(n,t,r,o):function(n){return K(n)&&v(z(n),".")}(r)?function(n,e,t,r){{let o=z(t).substring(1),i=R(r),u=Y(r);return{type:"CallExpression",callee:{type:"MemberExpression",object:mn(n,i),property:{type:"Identifier",name:o,loc:X(t).loc},computed:!1},arguments:hn(n,u),loc:e}}}(n,t,r,o):function(n){return K(n)&&i(Dn,n)}(r)?c(Dn,r)(n,t,o):function(n,e,t,r){return{type:"CallExpression",callee:mn(n,t),arguments:hn(n,r),loc:e}}(n,t,r,o)}}(n,e):vn(n,e)}function dn(n){return K(n)&&v(z(n),".-")}function mn(n,e){{let t=pn(n,e);return I(t)||yn(t)?t:function(n){return function(n){return{type:"CallExpression",callee:{type:"ArrowFunctionExpression",id:null,params:[],body:{type:"BlockStatement",body:[gn(n)],loc:n.loc}},arguments:[]}}(n)}(t)}}function yn(n){{let e=n.type;return"Literal"===e||"Identifier"===e||E(e,"Expression")||E(e,"Element")}}function gn(n){{let e=n.type;return"ReturnStatement"===e||"ForOfStatement"===e||"ContinueStatement"===e||"ThrowStatement"===e?n:"ExpressionStatement"===e?{type:"ReturnStatement",argument:n.expression,loc:n.loc}:"BlockStatement"===e?{type:"BlockStatement",body:bn(n.body),loc:n.loc}:"WhileStatement"===e?{type:"WhileStatement",test:n.test,body:gn(n.body),loc:n.loc}:"IfStatement"===e?{type:"IfStatement",test:n.test,consequent:gn(n.consequent),alternate:n.alternate?gn(n.alternate):null,loc:n.loc}:j(x("Unsupported return statement: ",e))}}function bn(n){return xn(n)?[{type:"ReturnStatement",argument:null}]:sn(n,null,gn)}function xn(n){return 0===n.length}function hn(n,e){return Sn(e,e=>mn(n,e))}function Sn(n,e){return an(en(n,e))}function vn(n,e){return void 0===e?j("Undefined!"):En(e)?pn(n,t(r("string->keyword"),wn(e))):function(n){return"number"==typeof n||n instanceof Number}(o=e)&&o<0?{type:"UnaryExpression",operator:"-",prefix:!0,argument:{type:"Literal",value:jn(In(e))},loc:m(e)&&X(e)?X(e).loc:void 0}:{type:"Literal",value:In(e),loc:m(e)&&X(e)?X(e).loc:void 0};var o}function En(n){return n instanceof w}function wn(n){return n.name}function jn(n){return-1*n}function In(n){return m(n)?n.valueOf():null}function Nn(n){return I(n)?"nil":JSON.stringify(n)}function kn(n){return(e,t,r)=>(xn(r)&&j("Empty operator expression"),hn(e,r).reduce((e,r)=>({type:"BinaryExpression",operator:n,left:e,right:r,loc:t})))}function An(n,e){return function(n){return on(n)&&1===n.length}(e)?fn(n,R(e)):{type:"BlockStatement",body:Fn(n,e)}}function Fn(n,e){return Sn(e,e=>fn(n,e))}function qn(n,e){return{type:"VariableDeclaration",kind:"let",declarations:en(Array.from(Cn(e,2)),e=>({type:"VariableDeclarator",id:rn(n,R(e)),init:mn(n,P(e))})),loc:X(e).loc}}function*Cn(n,e){{let t=0;for(;;){if(!(t<n.length))return;yield n.slice(t,t+e),t+=e}}}function Vn(...n){return en(R(n),(e,t)=>en(n,n=>n[t]))}function Bn(n){return K(n)?t(r("string->symbol"),z(n)):on(n)?W(t(r("js/array")),en(Bn,n)):n}function Mn(n){return n.index<n.input.length}let Un=n(),Wn=n(),On=Symbol("meta"),Ln=n();e(Ln,"'",(function(n){return t(r("quote"),l(n))})),e(Ln,"\\",(function(n){{let e=b(n);return"newline"===e?"\n":"return"===e?"\r":"tab"===e?"\t":"space"===e?" ":1===e.length?e:j("Unrecognized char: '"+e+"'")}})),e(Ln,'"',(function(n,e){{let e="";for(;;){let t=x(e,f(n,n=>'"'===n||"\\"===n)),r=h(n);if(I(r))return j("Unexpected EOF while reading string");if('"'===r)return t;if("\\"===r){let r=h(n),o=I(r)?j("Unexpected EOF while reading character escape"):'"'===r||"\\"===r||"/"===r?r:"n"===r?"\n":"t"===r?"\t":"r"===r?"\r":"u"===r?N(n):x(j("Unrecognized character escape"));e=x(t,o);continue}}}})),e(Ln,"(",(function(n,e){return k(n,")")})),e(Ln,")",L),e(Ln,"[",(function(n,e){return k(n,"]")})),e(Ln,"]",L),e(Ln,"{",(function(n,e){return t(r("dict"),...k(n,"}"))})),e(Ln,"}",L);let Rn=function(...n){return new Set(n)}("var","let","const"),Dn=n();e(Dn,r("defn"),(function(n,e,t){{let r=R(t),o=D(r),i=P(t),u=J(t),c=T(R(u))&&G(Y(u))?R(u):void 0,l=c?Y(u):u;Z(n);return H(n,r,{name:r,ident:o,params:i,docs:c,body:l,loc:e,generator:!1})}})),e(Dn,r("defgen"),(function(n,e,t){{let r=R(t),o=D(r),i=P(t),u=J(t),c=T(R(u))&&G(Y(u))?R(u):void 0,l=c?Y(u):u;Z(n);return H(n,r,{name:r,ident:o,params:i,docs:c,body:l,loc:e,generator:!0})}})),e(Dn,r("set!"),(function(n,e,t){{let o=R(t),i=P(t);return K(o)?function(n,e,t,r){return{type:"AssignmentExpression",operator:"=",left:Q(n,t),right:mn(n,r),loc:e}}(n,e,o,i):on(o)?function(n,e,t,o){{let i=R(t),u=Y(t);return dn(i)?function(n,e,t,r,o){{let i=z(t).substring(2),u=R(r);return{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",object:mn(n,u),property:{type:"Identifier",name:i,loc:X(t).loc},computed:!1},right:mn(n,o),loc:e}}}(n,e,i,u,o):i===r("js/index")?function(n,e,t,r){{let o=R(t),i=P(t);return{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",object:mn(n,o),property:mn(n,i),computed:!0},right:mn(n,r),loc:e}}}(n,e,u,o):j(x("Invalid setter: ",Nn(t)))}}(n,e,o,i):j(x("Invalid setter: ",Nn(o)))}})),e(Dn,r("and"),kn("&&")),e(Dn,r("or"),kn("||")),e(Dn,r("js/and"),kn("&&")),e(Dn,r("js/or"),kn("||")),e(Dn,r("js/==="),kn("===")),e(Dn,r("js/!=="),kn("!==")),e(Dn,r("js/=="),kn("==")),e(Dn,r("js/!="),kn("!=")),e(Dn,r("="),kn("===")),e(Dn,r("!="),kn("!==")),e(Dn,r(">="),kn(">=")),e(Dn,r("<="),kn("<=")),e(Dn,r(">"),kn(">")),e(Dn,r("<"),kn("<")),e(Dn,r("+"),kn("+")),e(Dn,r("-"),kn("-")),e(Dn,r("*"),kn("*")),e(Dn,r("/"),kn("/")),e(Dn,r("mod"),kn("%")),e(Dn,r("js/instanceof"),kn("instanceof")),e(Dn,r("spread"),(function(n,e,t){return{type:"SpreadElement",argument:mn(n,R(t)),loc:e}})),e(Dn,r("js/array"),(function(n,e,t){return{type:"ArrayExpression",elements:hn(n,t),loc:e}})),e(Dn,r("fn"),(function(n,e,t){{let r=R(t),o=Y(t),i=Z(n);return{type:"ArrowFunctionExpression",id:null,params:nn(i,r),body:cn(i,o),loc:e}}})),e(Dn,r("if"),(function(n,e,t){{let r=R(t),o=P(t),i=J(t);return{type:"IfStatement",test:mn(n,r),consequent:fn(n,o),alternate:m(i)?An(n,i):void 0,loc:e}}})),e(Dn,r("for"),(function(n,e,t){{let r=R(R(t)),o=P(R(t)),i=Y(t),u=Z(n);return{type:"ForOfStatement",left:tn(u,r),right:mn(u,o),body:An(u,i),loc:e}}})),e(Dn,r("def"),(function(n,e,t){return{type:"VariableDeclaration",kind:"let",declarations:[{type:"VariableDeclarator",id:rn(n,R(t)),init:mn(n,P(t)),loc:e}],loc:e}})),e(Dn,r("let"),(function(n,e,t){{let r=R(t),o=Y(t),i=Z(n);return{type:"BlockStatement",body:[qn(i,r),...Fn(i,o)],loc:e}}})),e(Dn,r("cond"),(function n(e,t,o){{let i=R(o),u=Y(o),c=R(i),l=Y(i);return c===r("else")?An(e,l):{type:"IfStatement",test:mn(e,c),consequent:An(e,l),alternate:G(u)?n(e,t,u):void 0}}})),e(Dn,r("loop"),(function(n,e,t){{let e=R(t),r=Y(t),o=function(n){return{variables:_(n.variables),loopVariables:[],functions:n.functions,functionNodes:n.functionNodes,isLoop:!0}}(n);return xn(e)?{type:"WhileStatement",test:vn(o,!0),body:cn(o,r)}:{type:"BlockStatement",body:[qn(o,e),{type:"WhileStatement",test:vn(o,!0),body:cn(o,r)}]}}})),e(Dn,r("do"),(function(n,e,t){return{type:"BlockStatement",body:Fn(n,t),loc:e}})),e(Dn,r("yield"),(function(n,e,t){return{type:"YieldExpression",argument:mn(n,R(t)),loc:e}})),e(Dn,r("recur"),(function(n,e,t){return n.loopVariables.length!==t.length&&j("Recur with not enough args"+n.loopVariables.length+t.length),xn(t)?{type:"ContinueStatement",loc:e}:{type:"BlockStatement",body:[...en(Vn(n.loopVariables,t),e=>({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:tn(n,R(e)),right:mn(n,P(e))}})),{type:"ContinueStatement"}],loc:e}})),e(Dn,r("dict"),(function(n,e,t){return{type:"ObjectExpression",properties:en(Array.from(Cn(t,2)),e=>({type:"Property",key:En(R(e))?vn(n,$(wn(R(e)))):vn(n,R(e)),value:mn(n,P(e))}))}})),e(Dn,r("quote"),(function(n,e,t){return pn(n,Bn(R(t)))})),e(Dn,r("js/return"),(function(n,e,t){return{type:"ReturnStatement",argument:G(t)?mn(n,R(t)):null,loc:e}})),e(Dn,r("js/throw"),(function(n,e,t){return{type:"ThrowStatement",argument:mn(n,R(t)),loc:e}})),e(Dn,r("js/new"),(function(n,e,t){return{type:"NewExpression",callee:mn(n,R(t)),arguments:hn(n,Y(t)),loc:e}})),e(Dn,r("js/index"),(function(n,e,t){{let e=R(t),r=P(t);return{type:"MemberExpression",object:mn(n,e),property:mn(n,r),computed:!0}}})),require("source-map-support/register");let $n=require("fs"),zn=require("path"),Pn=require("escodegen"),Jn=require("terser"),Tn=require("commander").program;Tn.option("-o, --output <filename>","Output JS filename"),Tn.option("-m, --map","Generate source maps"),Tn.parse(process.argv);{let e=Tn.output,r=Tn.map?e?zn.basename(e)+".map":"inline":void 0,o=$n.readFileSync(0,"utf-8"),i=function(e){{let t={functions:n(),functionNodes:n(),variables:n(),isLoop:!1},r=Fn(t,e);return{type:"Program",body:[...t.functionNodes.values(),...r]}}}(function(n){{let e=t();for(;;){if(a(n),!Mn(n))return e;e=W(e,O(n))}}}(function(n){return{input:n,index:0,indentWarnings:[]}}(o))),u=Pn.generate(i,{sourceMap:"stdin",sourceMapWithCode:!0,sourceContent:o}),c=u.map.toString(),l=Jn.minify(u.code,{toplevel:!0,sourceMap:r?{content:c,url:r}:void 0});l.error?console.error(l.error):e?($n.writeFileSync(e,l.code),r&&"inline"!==r&&$n.writeFileSync(r,l.map.toString())):function(...n){console.log(...n)}(l.code)}
//# sourceMappingURL=knight.js.map