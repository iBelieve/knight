function t(t){this.name=t}function e(t){this.name=t}function n(t){return!1===t||null==t}function r(t){return null==t}function o(t){return null!=t}function i(e){return e instanceof t}function u(t){return t instanceof e}function c(t){return"string"==typeof t||t instanceof String}function l(t){return Array.isArray(t)}function a(t){return 0===t.length}function s(t){return o(t)&&t.length>0}function f(...t){return[...t]}function p(t,e){return t.map(e)}function m(t,e,n){return t.map((o,i)=>i===t.length-1?n(o):r(e)?o:e(o))}function d(t,...e){return[...t,...e]}function y(t,e){return t+e}function g(t,e){return t.startsWith(e)}function b(t,e){return t.endsWith(e)}function x(){return new Map}function S(t,e){return t.get(e)}function h(t,e,n){return t.set(e,n)}function v(t){return new Map(t)}function E(t,e){return t.has(e)}let w=x(),j=x();function A(e){return n(E(w,e))&&h(w,e,new t(e)),S(w,e)}function I(t){return t.name}function k(t){return t.name}function F(t){return t[0]}function V(t){return t[1]}function q(t){return t.slice(1)}function C(t){return t.slice(2)}function B(t,e){return new RegExp(t,e)}function M(t){throw new Error(t)}function U(t,e){return l(t)&&F(t)===e}function O(t){return r(t)?"nil":JSON.stringify(t)}function*R(t,e){{let n=0;for(;;){if(!(n<t.length))return;yield t.slice(n,n+e),n+=e}}}function L(...t){return p(F(t),(e,n)=>p(t,t=>t[n]))}let W=Symbol("meta");function D(t){return t[W]}function $(t){return{input:t,index:0}}let z=x();function N(t){{let e=B("\r\n?|\n","g");{let n=1,r=0;for(;;){e.lastindex=r;{let o=e.exec(t.input);if(o&&o.index<t.index){n+=1,r=o.index+o[0].length;continue}return{line:n,column:t.index-r}}}}}}function P(t){{let e=t.input[t.index];return t.index=t.index+1,e}}function J(t){return t.input[t.index]}function T(t){return t.index<t.input.length}function G(t){return" "===t||"\t"===t||"\n"===t||","===t}function Y(t){return E(z,t)}function Z(t,e){{let n=t.index,r=t.input.length;{let o=t.index;for(;;){if(o>=r||e(t.input[o]))return t.index=o,t.input.substring(n,o);o+=1}}}}function _(t,e){return Z(t,t=>n(e(t)))}function H(t){for(;;){if(_(t,t=>G(t)),";"!==J(t))return;Z(t,t=>"\n"===t)}}function K(t){return y(P(t),Z(t,t=>G(t)||Y(t)))}function Q(t){return"nil"===t?null:"true"===t||"false"!==t&&(g(t,":")||b(t,":")?function(t){{let r=g(t,":")?t.substring(1):b(t,":")?t.substring(0,t.length-1):t;return n(E(j,r))&&h(j,r,new e(r)),S(j,r)}}(t):A(t))}function X(t,e){return M(y("Unmatched delimiter: ",e))}function tt(t){{let e=P(t),n=P(t),r=P(t),o=P(t);return String.fromCharCode(parseInt(e+n+r+o))}}function et(t,e){{let n=f();for(;;){H(t);{let o=J(t);if(r(o))return M("Unexpected EOF, expected: "+e);if(o===e)return P(t),n;n=d(n,rt(t));continue}}}}function nt(t){H(t);{let n=J(t);if((e=n)>="0"&&e<="9")return function(t){{let e=K(t);return function(t,e){return t.includes(e)}(e,".")?parseFloat(e):parseInt(e)}}(t);if(Y(n)){let e=S(z,n);return P(t),e(t,n)}return Q(K(t))}var e}function rt(t){{let e=N(t),n=nt(t),r=N(t);return o(n)&&function(t,e){t[W]=e}(n,{loc:{source:t.input,start:e,end:r}}),n}}h(z,"'",(function(t){return f(A("quote"),nt(t))})),h(z,"\\",(function(t){{let e=K(t);return"newline"===e?"\n":"return"===e?"\r":"tab"===e?"\t":"space"===e?" ":1===e.length?e:M("Unrecognized char: '"+e+"'")}})),h(z,'"',(function(t,e){{let e="";for(;;){let n=y(e,Z(t,t=>'"'===t||"\\"===t)),o=P(t);if(r(o))return M("Unexpected EOF while reading string");if('"'===o)return n;if("\\"===o){let o=P(t),i=r(o)?M("Unexpected EOF while reading character escape"):'"'===o||"\\"===o||"/"===o?o:"n"===o?"\n":"t"===o?"\t":"r"===o?"\r":"u"===o?tt(t):y(M("Unrecognized character escape"));e=y(n,i);continue}}}})),h(z,"(",(function(t,e){return et(t,")")})),h(z,")",X),h(z,"[",(function(t,e){return et(t,"]")})),h(z,"]",X),h(z,"{",(function(t,e){return f(A("dict"),...et(t,"}"))})),h(z,"}",X);let ot=function(...t){return new Set(t)}("var","let","const"),it=x();function ut(t){return i(t)&&g(I(t),".-")}function ct(t){{let e=t.type;return"Literal"===e||"Identifier"===e||b(e,"Expression")||b(e,"Element")}}function lt(t,e){if(D(t)&&D(t).loc){let n=D(t).loc,r=n.start.line-1,o=r+1,i=r-1,u=n.source.split("\n"),c=u[r],l=u[o],a=u[i],s=n.start.column;return M(e+"\n\n"+a+"\n"+c+"\n"+y(" ".repeat(s),"^")+"\n"+l)}return M(e)}function at(t){return{variables:v(t.variables),loopVariables:o(t.loopVariables)?(e=t.loopVariables,Array.from(e)):void 0,isLoop:!1};var e}function st(t){return function(t){return t.replace("!","").replace("->","-to-").replace(B("^((contains|has).*)\\?$"),"$1").replace(B("^(.*)\\?$"),"is-$1")}(t).replace(B("[-_]([a-zA-Z])","g"),(t,e)=>e.toUpperCase())}function ft(t){return function(t){return function(t,e){return t.has(e)}(ot,t)}(t)?y(t,"$"):t}function pt(t){return t===A("Symbol")?"LispSymbol":ft(st(I(t)))}function mt(t,e){{let r=t.variables;return n(E(r,e))&&h(r,e,pt(e)),t.isLoop&&t.loopVariables.push(e),yt(t,e)}}function dt(t,e){{let r=t.variables;return n(E(r,e))&&h(r,e,pt(e)),yt(t,e)}}function yt(t,e){{let r=t.variables,o=I(e),i=D(e)?D(e).loc:void 0;return g(o,"js/")?{type:"Identifier",name:o.substring(3),originalName:o,loc:i}:n(E(r,e))?lt(e,"Symbol not found: "+o):{type:"Identifier",name:S(r,e),originalName:I(e),loc:i}}}function gt(t){return function(t){return{type:"CallExpression",callee:{type:"ArrowFunctionExpression",id:null,params:[],body:{type:"BlockStatement",body:[bt(t)],loc:t.loc}},arguments:[]}}(t)}function bt(t){{let n=t.type;return"ReturnStatement"===n||"ForOfStatement"===n||"ContinueStatement"===n||"ThrowStatement"===n?t:"ExpressionStatement"===n?{type:"ReturnStatement",argument:t.expression,loc:t.loc}:"BlockStatement"===n?{type:"BlockStatement",body:(e=t.body,a(e)?[{type:"ReturnStatement",argument:null}]:m(e,null,bt)),loc:t.loc}:"WhileStatement"===n?{type:"WhileStatement",test:t.test,body:bt(t.body),loc:t.loc}:"IfStatement"===n?{type:"IfStatement",test:t.test,consequent:bt(t.consequent),alternate:t.alternate?bt(t.alternate):null,loc:t.loc}:M(y("Unsupported return statement: ",n))}var e}function xt(t,e){return m(e,e=>vt(t,e),e=>function(t,e){{let n=kt(t,e);return ct(n)?{type:"ReturnStatement",argument:n,loc:n.loc}:bt(n)}}(t,e))}function St(t,e){return{type:"BlockStatement",body:xt(t,e)}}function ht(t,e){return p(e,e=>vt(t,e))}function vt(t,e){{let n=kt(t,e);return ct(n)?{type:"ExpressionStatement",expression:n,loc:n.loc}:n}}function Et(t,e){return p(e,e=>wt(t,e))}function wt(t,e){{let n=kt(t,e);return ct(n)?n:gt(n)}}function jt(t,e){return p(e,e=>At(t,e))}function At(t,e){return i(e)?mt(t,e):U(e,A("spread"))?{type:"RestElement",argument:mt(t,V(e)),loc:D(e).loc}:l(e)?{type:"ArrayPattern",elements:jt(t,e)}:lt(e,"Unrecognized pattern")}function It(t,e){return function(t){return l(t)&&1===t.length}(e)?vt(t,F(e)):{type:"BlockStatement",body:ht(t,e)}}function kt(t,e){return i(e)?function(t,e){return yt(t,e)}(t,e):l(e)?function(t,e){{let n=D(e)?D(e).loc:void 0,r=F(e),o=q(e);return ut(r)?function(t,e,n,r){{let o=I(n).substring(2),i=F(r);return{type:"MemberExpression",object:wt(t,i),property:{type:"Identifier",name:o,loc:D(n).loc},computed:!1,loc:e}}}(t,n,r,o):function(t){return i(t)&&g(I(t),".")}(r)?function(t,e,n,r){{let o=I(n).substring(1),i=F(r),u=q(r);return{type:"CallExpression",callee:{type:"MemberExpression",object:wt(t,i),property:{type:"Identifier",name:o,loc:D(n).loc},computed:!1},arguments:Et(t,u),loc:e}}}(t,n,r,o):function(t){return i(t)&&E(it,t)}(r)?S(it,r)(t,n,o):function(t,e,n,r){return{type:"CallExpression",callee:wt(t,n),arguments:Et(t,r),loc:e}}(t,n,r,o)}}(t,e):Ft(t,e)}function Ft(t,e){return void 0===e?M("Undefined!"):u(e)?kt(t,f(A("string->keyword"),k(e))):{type:"Literal",value:(n=e,o(n)?n.valueOf():null),loc:o(e)&&D(e)?D(e).loc:void 0};var n}function Vt(t,e,n){return{type:"ReturnStatement",argument:s(n)?wt(t,F(n)):void 0,loc:e}}function qt(t){return(e,n,r)=>(a(r)&&M("Empty operator expression"),Et(e,r).reduce((e,r)=>({type:"BinaryExpression",operator:t,left:e,right:r,loc:n})))}function Ct(t,e){return{type:"VariableDeclaration",kind:"let",declarations:p(Array.from(R(e,2)),e=>({type:"VariableDeclarator",id:mt(t,F(e)),init:wt(t,V(e))})),loc:D(e).loc}}function Bt(t){return i(t)?f(A("string->symbol"),I(t)):l(t)?d(f(A("js/array")),p(Bt,t)):t}function Vt(t,e,n){return{type:"ReturnStatement",argument:s(n)?wt(t,F(n)):null,loc:e}}h(it,A("defn"),(function(t,e,n){{let r=dt(t,F(n)),o=V(n),i=C(n),u=(c(F(i))&&s(q(i))?F(i):void 0)?q(i):i,l=at(t);return{type:"FunctionDeclaration",id:r,params:jt(l,o),body:St(l,u),loc:e}}})),h(it,A("defgen"),(function(t,e,n){{let r=dt(t,F(n)),o=V(n),i=C(n),u=(c(F(i))&&s(q(i))?F(i):void 0)?q(i):i,l=at(t);return{type:"FunctionDeclaration",id:r,params:jt(l,o),body:St(l,u),generator:!0,loc:e}}})),h(it,A("return"),Vt),h(it,A("set!"),(function(t,e,n){{let r=F(n),o=V(n);return i(r)?function(t,e,n,r){return{type:"AssignmentExpression",operator:"=",left:yt(t,n),right:wt(t,r),loc:e}}(t,e,r,o):l(r)?function(t,e,n,r){{let o=F(n),i=q(n);return ut(o)?function(t,e,n,r,o){{let i=I(n).substring(2),u=F(r);return{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",object:wt(t,u),property:{type:"Identifier",name:i,loc:D(n).loc},computed:!1},right:wt(t,o),loc:e}}}(t,e,o,i,r):o===A("js/index")?function(t,e,n,r){{let o=F(n),i=V(n);return{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",object:wt(t,o),property:wt(t,i),computed:!0},right:wt(t,r),loc:e}}}(t,e,i,r):M(y("Invalid setter: ",O(n)))}}(t,e,r,o):M(y("Invalid setter: ",O(r)))}})),h(it,A("and"),qt("&&")),h(it,A("or"),qt("||")),h(it,A("js/and"),qt("&&")),h(it,A("js/or"),qt("||")),h(it,A("js/==="),qt("===")),h(it,A("js/!=="),qt("!==")),h(it,A("js/=="),qt("==")),h(it,A("js/!="),qt("!=")),h(it,A("="),qt("===")),h(it,A("!="),qt("!==")),h(it,A(">="),qt(">=")),h(it,A("<="),qt("<=")),h(it,A(">"),qt(">")),h(it,A("<"),qt("<")),h(it,A("+"),qt("+")),h(it,A("-"),qt("-")),h(it,A("mod"),qt("%")),h(it,A("js/instanceof"),qt("instanceof")),h(it,A("spread"),(function(t,e,n){return{type:"SpreadElement",argument:wt(t,F(n)),loc:e}})),h(it,A("js/array"),(function(t,e,n){return{type:"ArrayExpression",elements:Et(t,n),loc:e}})),h(it,A("fn"),(function(t,e,n){{let r=F(n),o=q(n),i=at(t);return{type:"ArrowFunctionExpression",id:null,params:jt(i,r),body:St(i,o),loc:e}}})),h(it,A("if"),(function(t,e,n){{let r=F(n),i=V(n),u=C(n);return{type:"IfStatement",test:wt(t,r),consequent:vt(t,i),alternate:o(u)?It(t,u):void 0,loc:e}}})),h(it,A("for"),(function(t,e,n){{let r=F(F(n)),o=V(F(n)),i=q(n),u=at(t);return{type:"ForOfStatement",left:At(u,r),right:wt(u,o),body:It(u,i),loc:e}}})),h(it,A("def"),(function(t,e,n){return{type:"VariableDeclaration",kind:"let",declarations:[{type:"VariableDeclarator",id:mt(t,F(n)),init:wt(t,V(n)),loc:e}],loc:e}})),h(it,A("let"),(function(t,e,n){{let r=F(n),o=q(n),i=at(t);return{type:"BlockStatement",body:[Ct(i,r),...ht(i,o)],loc:e}}})),h(it,A("cond"),(function(t,e,n){return function e(n){{let r=F(n),o=q(n),i=F(r),u=q(r);return i===A("else")?It(t,u):{type:"IfStatement",test:wt(t,i),consequent:It(t,u),alternate:s(o)?e(o):void 0}}}(n)})),h(it,A("loop"),(function(t,e,n){{let e=F(n),r=q(n),o=function(t){return{variables:v(t.variables),loopVariables:[],isLoop:!0}}(t);return a(e)?{type:"WhileStatement",test:Ft(o,!0),body:St(o,r)}:{type:"BlockStatement",body:[Ct(o,e),{type:"WhileStatement",test:Ft(o,!0),body:St(o,r)}]}}})),h(it,A("do"),(function(t,e,n){return{type:"BlockStatement",body:ht(t,n),loc:e}})),h(it,A("yield"),(function(t,e,n){return{type:"YieldExpression",argument:wt(t,F(n)),loc:e}})),h(it,A("recur"),(function(t,e,n){return t.loopVariables.length!==n.length&&M("Recur with not enough args"+t.loopVariables.length+n.length),a(n)?{type:"ContinueStatement",loc:e}:{type:"BlockStatement",body:[...p(L(t.loopVariables,n),e=>({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:At(t,F(e)),right:wt(t,V(e))}})),{type:"ContinueStatement"}],loc:e}})),h(it,A("dict"),(function(t,e,n){return{type:"ObjectExpression",properties:p(Array.from(R(n,2)),e=>({type:"Property",key:u(F(e))?Ft(t,st(k(F(e)))):Ft(t,F(e)),value:wt(t,V(e))}))}})),h(it,A("quote"),(function(t,e,n){return kt(t,Bt(F(n)))})),h(it,A("js/return"),Vt),h(it,A("js/throw"),(function(t,e,n){return{type:"ThrowStatement",argument:wt(t,F(n)),loc:e}})),h(it,A("js/new"),(function(t,e,n){return{type:"NewExpression",callee:wt(t,F(n)),arguments:Et(t,q(n)),loc:e}})),h(it,A("js/index"),(function(t,e,n){{let e=F(n),r=V(n);return{type:"MemberExpression",object:wt(t,e),property:wt(t,r),computed:!0}}})),require("source-map-support/register");let Mt=require("fs"),Ut=require("escodegen"),Ot=require("terser"),Rt=require("commander").program;Rt.option("-o, --output <filename>","Output JS filename"),Rt.option("-m, --map","Generate source maps"),Rt.parse(process.argv);{let t=Rt.output,e=Rt.map?t?t+".map":"inline":void 0,n=Mt.readFileSync(0,"utf-8"),r=function(t){{let e={variables:x(),isLoop:!1};for(form of t)U(form,A("defn"))&&mt(e,V(form));return{type:"Program",body:ht(e,t)}}}(function(t){{let e=f();for(;;){if(H(t),!T(t))return e;e=d(e,rt(t))}}}($(n))),o=Ut.generate(r,{sourceMap:"stdin",sourceMapWithCode:!0,sourceContent:n}),i=o.map.toString(),u=Ot.minify(o.code,{toplevel:!0,sourceMap:e?{content:i,url:e}:void 0});u.error?console.error(u.error):t?(Mt.writeFileSync(t,u.code),e&&"inline"!==e&&Mt.writeFileSync(e,u.map.toString())):function(...t){console.log(...t)}(u.code)}
//# sourceMappingURL=knight.js.map