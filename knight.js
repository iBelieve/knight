function n(){return new Map}function e(n,e,t){return n.set(e,t)}function t(...n){return[...n]}function r(n){return o(i(On,n))&&e(On,n,new u(n)),c(On,n)}function o(n){return!1===n||null==n}function i(n,e){return n.has(e)}function u(n){this.name=n}function c(n,e){return n.get(e)}function l(n){{let t=a(n),u=function(n,t){s(n);{let l=m(n);if(g(l))return b(n);if(v(l)){let e=c(Dn,l);return S(n),e(n,l,t)}return"+"!==l&&"-"!==l||!g(m(n,1))?"nil"===(u=h(n))?null:"true"===u||"false"!==u&&(E(u,":")||j(u,":")?function(n){{let t=E(n,":")?n.substring(1):j(n,":")?n.substring(0,n.length-1):n;return o(i(Ln,t))&&e(Ln,t,new w(t)),c(Ln,t)}}(u):r(u)):b(n)}var u}(n,t),l=a(n);return y(u)&&function(n,e){n[Rn]=e}(u,{loc:{source:n.input,start:t,end:l}}),u}}function a(n){return{line:n.line,column:n.column}}function s(n){for(;;){if(f(n,n=>d(n)),";"!==m(n))return;p(n,n=>"\n"===n)}}function f(n,e){return p(n,n=>o(e(n)))}function p(n,e){{let t=n.index,r=n.input.length;{let o=n.index,i=n.line,u=n.column;for(;;){let c=n.input[o];if(o>=r||e(c))return n.index=o,n.line=i,n.column=u,n.input.substring(t,o);if("\n"===c){o+=1,i+=1,u=0;continue}o+=1,i=i,u+=1;continue}}}}function d(n){return" "===n||"\t"===n||"\n"===n||","===n}function m(n,e){return n.input[y(e)?n.index+e:n.index]}function y(n){return null!=n}function g(n){return n>="0"&&n<="9"}function b(n){{let e=h(n);return function(n,e){return n.includes(e)}(e,".")?parseFloat(e):parseInt(e)}}function h(n){return x(S(n),p(n,n=>d(n)||v(n)))}function x(n,e){return n+e}function S(n){{let e=n.input[n.index];return n.index=n.index+1,"\n"===e?(n.line=n.line+1,n.column=0):n.column=n.column+1,e}}function v(n){return i(Dn,n)}function E(n,e){return n.startsWith(e)}function j(n,e){return n.endsWith(e)}function w(n){this.name=n}function I(n){return function(n){return e=n,"boolean"==typeof e||e instanceof Boolean||q(n)||N(n)||k(n);var e}(n)?n:A(n)?t(r("quote"),n):F(n,r("unquote"))?V(n):B(n)?t(r("list"),...M(n,I)):t(r("quote"),n)}function q(n){return"number"==typeof n||n instanceof Number}function N(n){return"string"==typeof n||n instanceof String}function k(n){return n instanceof w}function A(n){return n instanceof u}function F(n,e){return B(n)&&C(n)===e}function B(n){return Array.isArray(n)}function C(n){return n[0]}function V(n){return n[1]}function M(n,e){return n.map(e)}function U(n){throw new Error(n)}function W(n){return null==n}function O(n){{let e=S(n),t=S(n),r=S(n),o=S(n);return String.fromCharCode(parseInt(e+t+r+o))}}function L(n,e,r){{let i=!1,u=n.index-1,c=r.line,f=r.column;{let p=t();for(;;){if(o(i)){let t=a(n);s(n);{let r=a(n),o=r.line,l=r.column;o>c&&l<=f&&(i=!0,R(n,u,e,t))}}{let t=m(n);if(W(t))return D(n,u,r,e);if(t===e)return S(n),p;p=T(p,l(n));continue}}}}}function R(n,e,t,r){return n.indentWarnings.push({startIndex:e,endChar:t,pos:r})}function D(n,e,t,r){{let u=(o=n.indentWarnings,i=n=>n.startIndex>=e,o.find(i));return console.error(u),U("Unexpected EOF, expected: '"+r+"'\n\nStarted here:\n"+$(n.input,t)+"\n\nBased on indent:\n"+$(n.input,u.pos))}var o,i}function $(n,e){{let t=e.line-1,r=t-1,o=t+1,i=n.split("\n"),u=i[t],c=i[r]||"",l=i[o]||"",a=x(z(" ",e.column),"^"),s=P(t+1),f=P(r+1),p=P(o+1),d=function(...n){return Math.max(...n)}(s.length,f.length,p.length);return J(f,d)+" "+c+"\n"+J(s,d)+" "+u+"\n"+z(" ",d)+" "+a+"\n"+J(p,d)+" "+l}}function z(n,e){return n.repeat(e)}function P(n){return W(n)?"nil":n.toString()}function J(n,e,t){return n.padStart(e,t)}function T(n,...e){return[...n,...e]}function G(n,e){return U(x("Unmatched delimiter: ",e))}function Y(n){return n===r("Symbol")?"LispSymbol":function(n){return function(n,e){return n.has(e)}($n,n)}(e=Z(H(n)))?x(e,"$"):e;var e}function Z(n){return function(n){return n.replace("!","").replace("->","-to-").replace(_("^((contains|has).*)\\?$"),"$1").replace(_("^(.*)\\?$"),"is-$1")}(n).replace(_("[-_]([a-zA-Z])","g"),(n,e)=>e.toUpperCase())}function _(n,e){return new RegExp(n,e)}function H(n){return n.name}function K(n){return n.slice(2)}function Q(n){return y(n)&&n.length>0}function X(n){return n.slice(1)}function nn(n){return{variables:en(n.variables),loopVariables:n.loopVariables,functions:n.functions,functionNodes:n.functionNodes,isLoop:!1}}function en(n){return new Map(n)}function tn(n,t,r){{let o=n.functions;return i(o,t)?U("Function already defined: "+H(t)):e(o,t,r),null}}function rn(n,t){{let u=n.variables,l=n.functions,a=n.functionNodes,s=H(t),f=on(t)?on(t).loc:void 0;return E(s,"js/")?{type:"Identifier",name:s.substring(3),originalName:s,loc:f}:i(u,t)?{type:"Identifier",name:c(u,t),originalName:s,loc:f}:i(l,t)?(o(i(a,t))&&function(n,t){{let o=nn(n);e(n.functionNodes,t.name,r("placeholder")),e(n.functionNodes,t.name,{type:"FunctionDeclaration",id:{type:"Identifier",name:t.ident,originalName:H(t.name),loc:on(t.name).loc},params:un(o,t.params),body:sn(o,t.body),generator:t.generator,loc:t.loc})}}(n,c(l,t)),{type:"Identifier",name:c(l,t).ident,originalName:s,loc:f}):an(t,"Variable or function not found: "+s+" - "+M(Array.from(u.keys()),H)+" - "+M(Array.from(l.keys()),H))}}function on(n){return n[Rn]}function un(n,e){return M(e,e=>cn(n,e))}function cn(n,e){return A(e)?ln(n,e):F(e,r("spread"))?{type:"RestElement",argument:ln(n,V(e)),loc:on(e).loc}:B(e)?{type:"ArrayPattern",elements:un(n,e)}:an(e,"Unrecognized pattern")}function ln(n,t){{let r=n.variables;return o(i(r,t))&&e(r,t,Y(t)),n.isLoop&&n.loopVariables.push(t),rn(n,t)}}function an(n,e){if(on(n)&&on(n).loc){let t=on(n).loc;return U(e+"\n\n"+$(t.source,t.start))}return U(e)}function sn(n,e){return{type:"BlockStatement",body:fn(n,e)}}function fn(n,e){return pn(dn(e,e=>mn(n,e),e=>function(n,e){{let t=yn(n,e);return hn(t)?{type:"ReturnStatement",argument:t,loc:t.loc}:xn(t)}}(n,e)))}function pn(n){return function(n,e){return n.filter(e)}(n,n=>y(n))}function dn(n,e,t){return n.map((r,o)=>o===n.length-1?t(r):W(e)?r:e(r))}function mn(n,e){{let t=yn(n,e);return W(t)?t:hn(t)?{type:"ExpressionStatement",expression:t,loc:t.loc}:t}}function yn(n,e){return A(e)?function(n,e){return rn(n,e)}(n,e):B(e)?function(n,e){{let t=on(e)?on(e).loc:void 0,r=C(e),o=X(e);return gn(r)?function(n,e,t,r){{let o=H(t).substring(2),i=C(r);return{type:"MemberExpression",object:bn(n,i),property:{type:"Identifier",name:o,loc:on(t).loc},computed:!1,loc:e}}}(n,t,r,o):function(n){return A(n)&&E(H(n),".")}(r)?function(n,e,t,r){{let o=H(t).substring(1),i=C(r),u=X(r);return{type:"CallExpression",callee:{type:"MemberExpression",object:bn(n,i),property:{type:"Identifier",name:o,loc:on(t).loc},computed:!1},arguments:En(n,u),loc:e}}}(n,t,r,o):function(n){return A(n)&&i(zn,n)}(r)?c(zn,r)(n,t,o):function(n,e,t,r){return{type:"CallExpression",callee:bn(n,t),arguments:En(n,r),loc:e}}(n,t,r,o)}}(n,e):wn(n,e)}function gn(n){return A(n)&&E(H(n),".-")}function bn(n,e){{let t=yn(n,e);return W(t)||hn(t)?t:function(n){return function(n){return{type:"CallExpression",callee:{type:"ArrowFunctionExpression",id:null,params:[],body:{type:"BlockStatement",body:[xn(n)],loc:n.loc}},arguments:[]}}(n)}(t)}}function hn(n){{let e=n.type;return"Literal"===e||"Identifier"===e||j(e,"Expression")||j(e,"Element")}}function xn(n){{let e=n.type;return"ReturnStatement"===e||"ForOfStatement"===e||"ContinueStatement"===e||"ThrowStatement"===e?n:"ExpressionStatement"===e?{type:"ReturnStatement",argument:n.expression,loc:n.loc}:"BlockStatement"===e?{type:"BlockStatement",body:Sn(n.body),loc:n.loc}:"WhileStatement"===e?{type:"WhileStatement",test:n.test,body:xn(n.body),loc:n.loc}:"IfStatement"===e?{type:"IfStatement",test:n.test,consequent:xn(n.consequent),alternate:n.alternate?xn(n.alternate):null,loc:n.loc}:U(x("Unsupported return statement: ",e))}}function Sn(n){return vn(n)?[{type:"ReturnStatement",argument:null}]:dn(n,null,xn)}function vn(n){return 0===n.length}function En(n,e){return jn(e,e=>bn(n,e))}function jn(n,e){return pn(M(n,e))}function wn(n,e){return void 0===e?U("Undefined!"):k(e)?yn(n,t(r("string->keyword"),In(e))):q(o=e)&&o<0?{type:"UnaryExpression",operator:"-",prefix:!0,argument:{type:"Literal",value:qn(Nn(e))},loc:y(e)&&on(e)?on(e).loc:void 0}:{type:"Literal",value:Nn(e),loc:y(e)&&on(e)?on(e).loc:void 0};var o}function In(n){return n.name}function qn(n){return-1*n}function Nn(n){return y(n)?n.valueOf():null}function kn(n){return W(n)?"nil":JSON.stringify(n)}function An(n){return(e,t,r)=>(vn(r)&&U("Empty operator expression"),En(e,r).reduce((e,r)=>({type:"BinaryExpression",operator:n,left:e,right:r,loc:t})))}function Fn(n,e){return function(n){return B(n)&&1===n.length}(e)?mn(n,C(e)):{type:"BlockStatement",body:Bn(n,e)}}function Bn(n,e){return jn(e,e=>mn(n,e))}function Cn(n,e){return{type:"VariableDeclaration",kind:"let",declarations:M(Array.from(Vn(e,2)),e=>({type:"VariableDeclarator",id:ln(n,C(e)),init:bn(n,V(e))})),loc:on(e).loc}}function*Vn(n,e){{let t=0;for(;;){if(!(t<n.length))return;yield n.slice(t,t+e),t+=e}}}function Mn(...n){return M(C(n),(e,t)=>M(n,n=>n[t]))}function Un(n){return A(n)?t(r("string->symbol"),H(n)):B(n)?t(r("js/array"),...M(n,Un)):n}function Wn(n){return n.index<n.input.length}let On=n(),Ln=n(),Rn=Symbol("meta"),Dn=n();e(Dn,"'",(function(n,e,o){return t(r("quote"),l(n))})),e(Dn,"`",(function(n,e,t){return I(l(n))})),e(Dn,"&",(function(n,e,o){return t(r("spread"),l(n))})),e(Dn,"~",(function(n,e,o){return t(r("unquote"),l(n))})),e(Dn,"\\",(function(n){{let e=h(n);return"newline"===e?"\n":"return"===e?"\r":"tab"===e?"\t":"space"===e?" ":1===e.length?e:U("Unrecognized char: '"+e+"'")}})),e(Dn,'"',(function(n,e,t){{let e="";for(;;){let t=x(e,p(n,n=>'"'===n||"\\"===n)),r=S(n);if(W(r))return U("Unexpected EOF while reading string");if('"'===r)return t;if("\\"===r){let r=S(n),o=W(r)?U("Unexpected EOF while reading character escape"):'"'===r||"\\"===r||"/"===r?r:"n"===r?"\n":"t"===r?"\t":"r"===r?"\r":"u"===r?O(n):x(U("Unrecognized character escape"));e=x(t,o);continue}}}})),e(Dn,"(",(function(n,e,t){return L(n,")",t)})),e(Dn,")",G),e(Dn,"[",(function(n,e,t){return L(n,"]",t)})),e(Dn,"]",G),e(Dn,"{",(function(n,e,o){return t(r("dict"),...L(n,"}",o))})),e(Dn,"}",G);let $n=function(...n){return new Set(n)}("var","let","const"),zn=n();e(zn,r("defn"),(function(n,e,t){{let r=C(t),o=Y(r),i=V(t),u=K(t),c=N(C(u))&&Q(X(u))?C(u):void 0,l=c?X(u):u;nn(n);return tn(n,r,{name:r,ident:o,params:i,docs:c,body:l,loc:e,generator:!1})}})),e(zn,r("defgen"),(function(n,e,t){{let r=C(t),o=Y(r),i=V(t),u=K(t),c=N(C(u))&&Q(X(u))?C(u):void 0,l=c?X(u):u;nn(n);return tn(n,r,{name:r,ident:o,params:i,docs:c,body:l,loc:e,generator:!0})}})),e(zn,r("set!"),(function(n,e,t){{let o=C(t),i=V(t);return A(o)?function(n,e,t,r){return{type:"AssignmentExpression",operator:"=",left:rn(n,t),right:bn(n,r),loc:e}}(n,e,o,i):B(o)?function(n,e,t,o){{let i=C(t),u=X(t);return gn(i)?function(n,e,t,r,o){{let i=H(t).substring(2),u=C(r);return{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",object:bn(n,u),property:{type:"Identifier",name:i,loc:on(t).loc},computed:!1},right:bn(n,o),loc:e}}}(n,e,i,u,o):i===r("js/index")?function(n,e,t,r){{let o=C(t),i=V(t);return{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",object:bn(n,o),property:bn(n,i),computed:!0},right:bn(n,r),loc:e}}}(n,e,u,o):U(x("Invalid setter: ",kn(t)))}}(n,e,o,i):U(x("Invalid setter: ",kn(o)))}})),e(zn,r("and"),An("&&")),e(zn,r("or"),An("||")),e(zn,r("js/and"),An("&&")),e(zn,r("js/or"),An("||")),e(zn,r("js/==="),An("===")),e(zn,r("js/!=="),An("!==")),e(zn,r("js/=="),An("==")),e(zn,r("js/!="),An("!=")),e(zn,r("="),An("===")),e(zn,r("!="),An("!==")),e(zn,r(">="),An(">=")),e(zn,r("<="),An("<=")),e(zn,r(">"),An(">")),e(zn,r("<"),An("<")),e(zn,r("+"),An("+")),e(zn,r("-"),An("-")),e(zn,r("*"),An("*")),e(zn,r("/"),An("/")),e(zn,r("mod"),An("%")),e(zn,r("js/instanceof"),An("instanceof")),e(zn,r("spread"),(function(n,e,t){return{type:"SpreadElement",argument:bn(n,C(t)),loc:e}})),e(zn,r("js/array"),(function(n,e,t){return{type:"ArrayExpression",elements:En(n,t),loc:e}})),e(zn,r("fn"),(function(n,e,t){{let r=C(t),o=X(t),i=nn(n);return{type:"ArrowFunctionExpression",id:null,params:un(i,r),body:sn(i,o),loc:e}}})),e(zn,r("if"),(function(n,e,t){{let r=C(t),o=V(t),i=K(t);return{type:"IfStatement",test:bn(n,r),consequent:mn(n,o),alternate:y(i)?Fn(n,i):void 0,loc:e}}})),e(zn,r("for"),(function(n,e,t){{let r=C(C(t)),o=V(C(t)),i=X(t),u=nn(n);return{type:"ForOfStatement",left:cn(u,r),right:bn(u,o),body:Fn(u,i),loc:e}}})),e(zn,r("def"),(function(n,e,t){return{type:"VariableDeclaration",kind:"let",declarations:[{type:"VariableDeclarator",id:ln(n,C(t)),init:bn(n,V(t)),loc:e}],loc:e}})),e(zn,r("let"),(function(n,e,t){{let r=C(t),o=X(t),i=nn(n);return{type:"BlockStatement",body:[Cn(i,r),...Bn(i,o)],loc:e}}})),e(zn,r("cond"),(function n(e,t,o){{let i=C(o),u=X(o),c=C(i),l=X(i);return c===r("else")?Fn(e,l):{type:"IfStatement",test:bn(e,c),consequent:Fn(e,l),alternate:Q(u)?n(e,t,u):void 0}}})),e(zn,r("loop"),(function(n,e,t){{let e=C(t),r=X(t),o=function(n){return{variables:en(n.variables),loopVariables:[],functions:n.functions,functionNodes:n.functionNodes,isLoop:!0}}(n);return vn(e)?{type:"WhileStatement",test:wn(o,!0),body:sn(o,r)}:{type:"BlockStatement",body:[Cn(o,e),{type:"WhileStatement",test:wn(o,!0),body:sn(o,r)}]}}})),e(zn,r("do"),(function(n,e,t){return{type:"BlockStatement",body:Bn(n,t),loc:e}})),e(zn,r("yield"),(function(n,e,t){return{type:"YieldExpression",argument:bn(n,C(t)),loc:e}})),e(zn,r("recur"),(function(n,e,t){return n.loopVariables.length!==t.length&&U("Recur with not enough args"+n.loopVariables.length+t.length),vn(t)?{type:"ContinueStatement",loc:e}:{type:"BlockStatement",body:[...M(Mn(n.loopVariables,t),e=>({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:cn(n,C(e)),right:bn(n,V(e))}})),{type:"ContinueStatement"}],loc:e}})),e(zn,r("dict"),(function(n,e,t){return{type:"ObjectExpression",properties:M(Array.from(Vn(t,2)),e=>({type:"Property",key:k(C(e))?wn(n,Z(In(C(e)))):wn(n,C(e)),value:bn(n,V(e))}))}})),e(zn,r("quote"),(function(n,e,t){return yn(n,Un(C(t)))})),e(zn,r("js/return"),(function(n,e,t){return{type:"ReturnStatement",argument:Q(t)?bn(n,C(t)):null,loc:e}})),e(zn,r("js/throw"),(function(n,e,t){return{type:"ThrowStatement",argument:bn(n,C(t)),loc:e}})),e(zn,r("js/new"),(function(n,e,t){return{type:"NewExpression",callee:bn(n,C(t)),arguments:En(n,X(t)),loc:e}})),e(zn,r("js/index"),(function(n,e,t){{let e=C(t),r=V(t);return{type:"MemberExpression",object:bn(n,e),property:bn(n,r),computed:!0}}})),require("source-map-support/register");let Pn=require("fs"),Jn=require("path"),Tn=require("escodegen"),Gn=require("terser"),Yn=require("commander").program;Yn.option("-o, --output <filename>","Output JS filename"),Yn.option("-m, --map","Generate source maps"),Yn.parse(process.argv);{let e=Yn.output,r=e?Jn.dirname(e):void 0,o=Yn.map?e?Jn.basename(e)+".map":"inline":void 0,i=Pn.readFileSync(0,"utf-8"),u=function(e){{let t={functions:n(),functionNodes:n(),variables:n(),isLoop:!1},r=Bn(t,e);return{type:"Program",body:[...t.functionNodes.values(),...r]}}}(function(n){{let e=t();for(;;){if(s(n),!Wn(n))return e;e=T(e,l(n))}}}(function(n){return{input:n,index:0,line:1,column:0,indentWarnings:[]}}(i))),c=Tn.generate(u,{sourceMap:"stdin",sourceMapWithCode:!0,sourceContent:i}),a=c.map.toString(),f=Gn.minify(c.code,{toplevel:!0,sourceMap:o?{content:a,url:o}:void 0});f.error?console.error(f.error):e?(Pn.writeFileSync(e,f.code),o&&"inline"!==o&&Pn.writeFileSync(Jn.join(r,o),f.map.toString())):function(...n){console.log(...n)}(f.code)}
//# sourceMappingURL=knight.js.map